<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gra: Gminy woj. ≈õlƒÖskiego</title>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --bg: #0b0f19;
      --panel: #111827;
      --panel2: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: rgba(255,255,255,0.08);

      --vh: 1vh;
      --hudH: 64px;
    }

    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .app {
      display: grid;
      grid-template-columns: 360px 1fr;
      height: calc(var(--vh) * 100);
      min-height: 100vh;
    }

    .sidebar {
      padding: 16px;
      border-right: 1px solid var(--border);
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel2) 100%);
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    h1 { font-size: 18px; margin: 0 0 8px; }
    .sub { color: var(--muted); font-size: 13px; margin-bottom: 14px; line-height: 1.3; }

    .card {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      margin-bottom: 12px;
    }

    .label { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .target {
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.2px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px dashed rgba(255,255,255,0.18);
      background: rgba(96,165,250,0.12);
    }

    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    button {
      appearance: none;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 650;
      cursor: pointer;
      transition: transform 0.05s ease, background 0.15s ease, border-color 0.15s ease;
      flex: 1 1 auto;
      min-height: 44px;
    }
    button:hover { background: rgba(255,255,255,0.10); }
    button:active { transform: translateY(1px); }
    button.primary { background: rgba(96,165,250,0.18); border-color: rgba(96,165,250,0.35); }
    button.danger  { background: rgba(239,68,68,0.14); border-color: rgba(239,68,68,0.30); }
    button:disabled { opacity: 0.55; cursor: default; }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .stat {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      background: rgba(255,255,255,0.03);
    }
    .stat .k { font-size: 12px; color: var(--muted); }
    .stat .v { font-size: 20px; font-weight: 850; margin-top: 2px; }

    .msg {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      min-height: 44px;
      line-height: 1.25;
    }
    .msg.ok  { border-color: rgba(16,185,129,0.35); background: rgba(16,185,129,0.10); }
    .msg.bad { border-color: rgba(239,68,68,0.35); background: rgba(239,68,68,0.10); }

    .opt {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      font-size: 13px;
      color: var(--muted);
    }
    .opt input { transform: scale(1.05); }

    #map {
      width: 100%;
      height: calc(var(--vh) * 100);
      min-height: 100vh;
      background: #e5e7eb;
    }

    /* usuwa focus-ramkƒô po tapniƒôciu */
    .leaflet-container .leaflet-interactive:focus,
    .leaflet-container .leaflet-interactive:active,
    .leaflet-container svg path:focus,
    .leaflet-container svg path:active {
      outline: none !important;
    }

    .footer {
      font-size: 12px;
      color: var(--muted);
      margin-top: 14px;
      line-height: 1.35;
    }

    code.inline {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      background: rgba(255,255,255,0.08);
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid var(--border);
      color: #fff;
    }

    /* ===== Mobile drawer ===== */
    .panelToggle{
      display:none;
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 1400;
      border: 1px solid var(--border);
      background: rgba(17,24,39,0.92);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 800;
      line-height: 1;
      cursor: pointer;
      min-width: 44px;
      min-height: 44px;
    }
    .backdrop{
      display:none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 1300;
    }
    .backdrop.show{ display:block; }

    @media (max-width: 900px){
      .app{ grid-template-columns: 1fr; }
      .sidebar{
        position: fixed;
        top: 0;
        left: 0;
        width: min(360px, 88vw);
        height: calc(var(--vh) * 100);
        min-height: 100vh;
        z-index: 1500;
        transform: translateX(-105%);
        transition: transform 0.22s ease;
        border-right: 1px solid var(--border);
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      }
      .sidebar.open{ transform: translateX(0); }
      .panelToggle{ display:block; }
      .leaflet-top.leaflet-left{ margin-top: calc(var(--hudH) + 12px); }
    }

    /* ===== HUD (mobile top bar) ===== */
    .hud{
      display:none;
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1600;
      padding: calc(env(safe-area-inset-top) + 6px) 10px 8px;
      background: rgba(17,24,39,0.92);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }
    .hud .hudLeft{
      min-width: 0;
      display:flex;
      flex-direction: column;
      gap: 2px;
      flex: 1 1 auto;
    }
    .hud .hudLabel{
      font-size: 11px;
      color: var(--muted);
      line-height: 1.1;
    }
    .hud .hudTarget{
      font-size: 14px;
      font-weight: 850;
      line-height: 1.15;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 6px 10px;
      border-radius: 12px;
      border: 1px dashed rgba(255,255,255,0.18);
      background: rgba(96,165,250,0.12);
      max-width: 100%;
    }
    .hud .hudRight{
      display:flex;
      align-items:center;
      gap: 8px;
      flex: 0 0 auto;
    }
    .hud .hudStats{
      display:flex;
      flex-direction: column;
      gap: 2px;
      text-align: right;
      font-size: 12px;
      line-height: 1.1;
      color: var(--text);
    }
    .hud .hudK{ color: var(--muted); font-size: 11px; margin-right: 6px; }
    .hud .hudV{ font-weight: 850; }

    .hud .hudBtns{
      display:flex;
      gap: 6px;
      align-items:center;
    }
    .hudBtn{
      appearance:none;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      font-weight: 800;
      font-size: 12px;
      line-height: 1;
      min-height: 36px;
      min-width: 64px;
      cursor:pointer;
    }
    .hudBtn.primary{ background: rgba(96,165,250,0.18); border-color: rgba(96,165,250,0.35); }
    .hudBtn.danger{ background: rgba(239,68,68,0.14); border-color: rgba(239,68,68,0.30); }
    .hudBtn:disabled{ opacity: 0.55; cursor: default; }

    @media (max-width: 900px){
      .hud{ display:flex; }
      .panelToggle{ top: calc(env(safe-area-inset-top) + var(--hudH) + 10px); }
    }
  </style>
</head>

<body>
  <button id="panelToggle" class="panelToggle" aria-label="Poka≈º/ukryj panel">‚ò∞</button>
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>

  <div id="hud" class="hud" role="region" aria-label="Panel gry">
    <div class="hudLeft">
      <div class="hudLabel">Znajd≈∫:</div>
      <div id="hudTargetName" class="hudTarget">≈Åadowanie‚Ä¶</div>
    </div>
    <div class="hudRight">
      <div class="hudStats" aria-label="Wynik i postƒôp">
        <div><span class="hudK">Punkty</span><span id="hudScore" class="hudV">0</span></div>
        <div><span class="hudK">Postƒôp</span><span class="hudV"><span id="hudDone">0</span>/<span id="hudTotal">0</span></span></div>
      </div>
      <div class="hudBtns" aria-label="Sterowanie">
        <button id="hudNext" class="hudBtn primary" disabled aria-label="Nastƒôpna">Nastƒôpna</button>
        <button id="hudRestart" class="hudBtn danger" disabled aria-label="Restart">Restart</button>
      </div>
    </div>
  </div>

  <div class="app">
    <aside class="sidebar">
      <h1>Gra: gminy wojew√≥dztwa ≈õlƒÖskiego</h1>
      <div class="sub">
        Kliknij na mapie gminƒô o podanej nazwie. W trybie ‚ÄûPoznaj mapƒô‚Äù w≈ÇƒÖczajƒÖ siƒô tooltipy.
      </div>

      <div class="card">
        <div class="label">Znajd≈∫ i kliknij gminƒô:</div>
        <div class="target" id="targetName">≈Åadowanie‚Ä¶</div>

        <div class="row">
          <button class="primary" id="btnNext" disabled>Nastƒôpna</button>
          <button class="danger" id="btnRestart" disabled>Restart</button>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">Punkty</div>
            <div class="v" id="score">0</div>
          </div>
          <div class="stat">
            <div class="k">Postƒôp</div>
            <div class="v"><span id="done">0</span>/<span id="total">0</span></div>
          </div>
        </div>

        <div class="msg" id="message"></div>

        <div class="opt">
          <label>
            <input type="checkbox" id="learnMode" />
            Poznaj mapƒô (w≈ÇƒÖcz tooltip z nazwƒÖ)
          </label>
        </div>

        <div class="opt">
          <label>
            <input type="checkbox" id="showCorrect" checked />
            Poka≈º poprawnƒÖ gminƒô po b≈Çƒôdzie
          </label>
        </div>

        <div class="opt">
          <label>
            <input type="checkbox" id="shuffleEachRun" checked />
            Losuj kolejno≈õƒá (ka≈ºdy restart)
          </label>
        </div>
      </div>

      <div class="footer">
        ¬© 2026 r√≥wnie≈º na <code class="inline">http://github/:8000</code>.
      </div>
    </aside>

    <main id="map"></main>
  </div>

<script>
(async function () {
  // ======= Mobile viewport height fix =======
  function setVH(){
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }
  setVH();
  window.addEventListener('resize', setVH, { passive: true });
  window.addEventListener('orientationchange', () => setTimeout(setVH, 200), { passive: true });

  // ========== USTAWIENIA ==========
  const GEOJSON_FILE = "Slaskie_gminy.json";
  const NAME_FIELD = "JPT_NAZWA_";
  const CODE_FIELD = "JPT_KOD_JE";

  // style bazowy / hover / poprawne / b≈Çƒôdne
  const baseStyle    = { color:"rgba(0,0,0,0.85)", weight:1.2, opacity:0.9, fillColor:"#60a5fa", fillOpacity:0.85 };
  const hoverStyle   = { weight:2.6, opacity:1.0, fillOpacity:0.92 };
  const correctStyle = { color:"rgba(0,0,0,0.95)", weight:3.0, fillColor:"#10b981", fillOpacity:0.92 };
  const wrongStyle   = { color:"rgba(0,0,0,0.95)", weight:3.0, fillColor:"#ef4444", fillOpacity:0.92 };

  // (opcjonalne) kr√≥tkie pokazanie poprawnej po b≈Çƒôdzie
  const revealCorrectStyle = { color:"rgba(0,0,0,0.95)", weight:3.0, fillColor:"#10b981", fillOpacity:0.35 };

  // ========== UI ==========
  const elTarget = document.getElementById("targetName");
  const elScore = document.getElementById("score");
  const elDone  = document.getElementById("done");
  const elTotal = document.getElementById("total");
  const elMsg   = document.getElementById("message");

  const btnNext = document.getElementById("btnNext");
  const btnRestart = document.getElementById("btnRestart");

  const chkLearnMode = document.getElementById("learnMode");
  const chkShowCorrect = document.getElementById("showCorrect");
  const chkShuffleEachRun = document.getElementById("shuffleEachRun");

  // HUD
  const elHudTarget = document.getElementById("hudTargetName");
  const elHudScore  = document.getElementById("hudScore");
  const elHudDone   = document.getElementById("hudDone");
  const elHudTotal  = document.getElementById("hudTotal");
  const btnHudNext  = document.getElementById("hudNext");
  const btnHudRestart = document.getElementById("hudRestart");

  function setHudHeightVar(){
    const hud = document.getElementById("hud");
    if (!hud) return;
    const h = Math.max(44, Math.round(hud.getBoundingClientRect().height));
    document.documentElement.style.setProperty("--hudH", h + "px");
  }

  function setMessage(text, type) {
    elMsg.classList.remove("ok", "bad");
    if (type === "ok") elMsg.classList.add("ok");
    if (type === "bad") elMsg.classList.add("bad");
    elMsg.textContent = text || "";
  }

  // ========== MAPA ==========
  let map = null;
  map = L.map("map", { zoomControl: true });

  window.addEventListener("resize", () => map && map.invalidateSize(), { passive: true });
  window.addEventListener("orientationchange", () => setTimeout(() => map && map.invalidateSize(), 250), { passive: true });

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  // ========== PANEL MOBILE ==========
  const sidebar = document.querySelector(".sidebar");
  const btnPanel = document.getElementById("panelToggle");
  const backdrop = document.getElementById("backdrop");

  function setPanel(open) {
    if (!sidebar || !btnPanel || !backdrop) return;
    sidebar.classList.toggle("open", open);
    backdrop.classList.toggle("show", open);
    if (map) setTimeout(() => map.invalidateSize(), 260);
  }

  if (btnPanel && backdrop && sidebar) {
    btnPanel.addEventListener("click", () => setPanel(!sidebar.classList.contains("open")));
    backdrop.addEventListener("click", () => setPanel(false));
  }

  // ========== Wczytanie JSON ==========
  let geo;
  try {
    const res = await fetch(GEOJSON_FILE, { cache: "no-store" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    geo = await res.json();
  } catch (e) {
    setMessage("Nie uda≈Ço siƒô wczytaƒá pliku " + GEOJSON_FILE + ". Upewnij siƒô, ≈ºe dzia≈Ça przez HTTP/HTTPS.", "bad");
    console.error(e);
    return;
  }

  if (!geo || geo.type !== "FeatureCollection" || !Array.isArray(geo.features)) {
    setMessage("Plik JSON ma z≈Çy format (musi byƒá FeatureCollection).", "bad");
    return;
  }

  // lista gmin (unique po code)
  const allItems = geo.features
    .map(f => {
      const p = f.properties || {};
      const name = (p[NAME_FIELD] ?? "").toString().trim();
      const code = (p[CODE_FIELD] ?? "").toString().trim();
      return (name && code) ? { name, code } : null;
    })
    .filter(Boolean);

  const seen = new Set();
  const uniqueItems = [];
  for (const it of allItems) {
    if (seen.has(it.code)) continue;
    seen.add(it.code);
    uniqueItems.push(it);
  }

  elTotal.textContent = uniqueItems.length.toString();
  if (elHudTotal) elHudTotal.textContent = uniqueItems.length.toString();
  setHudHeightVar();

  // mapowanie code -> layer
  const layerByCode = new Map();

  // ‚úÖ STATUS: target gminy z pytania (zielona/czerwona na sta≈Çe)
  const statusByCode = new Map(); // code -> "ok" | "bad"

  function styleForCode(code){
    const st = statusByCode.get(code);
    if (st === "ok")  return { ...correctStyle };
    if (st === "bad") return { ...wrongStyle };
    return { ...baseStyle };
  }

  function applyPersistentStyle(layer){
    const p = layer?.feature?.properties || {};
    const code = (p[CODE_FIELD] ?? "").toString().trim();
    layer.setStyle(styleForCode(code));
  }

  function applyTooltip(layer, name, code) {
    layer.unbindTooltip();
    if (chkLearnMode.checked) layer.bindTooltip(name ? name : code, { sticky: true });
  }

  // ========== Stan gry ==========
  const state = {
    items: [],
    idx: 0,
    score: 0,
    done: 0,
    locked: false,
    current: null
  };

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // ========== Warstwa GeoJSON ==========
  const geoLayer = L.geoJSON(geo, {
    style: (feature) => {
      const p = feature.properties || {};
      const code = (p[CODE_FIELD] ?? "").toString().trim();
      return styleForCode(code);
    },
    onEachFeature: (feature, layer) => {
      const p = feature.properties || {};
      const name = (p[NAME_FIELD] ?? "").toString().trim();
      const code = (p[CODE_FIELD] ?? "").toString().trim();

      if (code) layerByCode.set(code, layer);

      applyTooltip(layer, name, code);
      chkLearnMode.addEventListener("change", () => applyTooltip(layer, name, code));

      // hover tylko dla non-touch (na touch i tak przesuwasz mapƒô)
      if (!L.Browser.touch) {
        layer.on("mouseover", () => {
          if (state.locked) return;
          // hover, ale zachowaj kolor trwa≈Çy (ok/bad/base)
          const st = styleForCode(code);
          layer.setStyle({ ...st, ...hoverStyle });
          layer.bringToFront();
        });
        layer.on("mouseout", () => {
          if (state.locked) return;
          applyPersistentStyle(layer);
        });
      }

      layer.on("click", () => {
        // usu≈Ñ focus-ramkƒô po tapniƒôciu
        const el = (layer.getElement && layer.getElement()) || layer._path;
        if (el && el.blur) el.blur();

        if (chkLearnMode.checked) return;
        if (state.locked) return;

        handleClick(code, name, layer);
      });
    }
  }).addTo(map);

  try { map.fitBounds(geoLayer.getBounds(), { padding: [12, 12] }); }
  catch (_) { map.setView([50.25, 19.0], 8); }

  function resetAllStyles(){
    geoLayer.eachLayer(l => applyPersistentStyle(l));
  }

  function startGame() {
    state.items = uniqueItems.slice();
    if (chkShuffleEachRun.checked) shuffle(state.items);

    state.idx = 0;
    state.score = 0;
    state.done = 0;
    state.locked = false;
    state.current = null;

    // ‚úÖ zerujemy wyniki trwa≈Çe
    statusByCode.clear();
    resetAllStyles();

    elScore.textContent = "0";
    elDone.textContent = "0";
    if (elHudScore) elHudScore.textContent = "0";
    if (elHudDone)  elHudDone.textContent  = "0";

    btnNext.disabled = true;
    if (btnHudNext) btnHudNext.disabled = true;

    btnRestart.disabled = false;
    if (btnHudRestart) btnHudRestart.disabled = false;

    nextQuestion();
  }

  function nextQuestion() {
    if (chkLearnMode.checked) {
      elTarget.textContent = "Tryb poznawania mapy";
      if (elHudTarget) elHudTarget.textContent = "Tryb poznawania mapy";
      setHudHeightVar();

      setMessage("Tooltipy sƒÖ w≈ÇƒÖczone. Klikniƒôcia nie punktujƒÖ. Odznacz tryb, aby graƒá.", "");
      btnNext.disabled = true;
      if (btnHudNext) btnHudNext.disabled = true;
      state.locked = false;
      return;
    }

    if (state.idx >= state.items.length) {
      elTarget.textContent = "KONIEC üéâ";
      if (elHudTarget) elHudTarget.textContent = "KONIEC üéâ";
      setHudHeightVar();

      setMessage(`Koniec! Wynik: ${state.score}/${state.items.length}.`, "ok");
      btnNext.disabled = true;
      if (btnHudNext) btnHudNext.disabled = true;
      state.locked = true;
      return;
    }

    state.current = state.items[state.idx];
    elTarget.textContent = state.current.name;
    if (elHudTarget) elHudTarget.textContent = state.current.name;
    setHudHeightVar();

    setMessage("Kliknij w≈Ça≈õciwƒÖ gminƒô na mapie.", "");
    btnNext.disabled = true;
    if (btnHudNext) btnHudNext.disabled = true;

    state.locked = false;
  }

  function handleClick(clickedCode, clickedName, clickedLayer) {
    state.locked = true;

    const target = state.current;
    const isCorrect = (clickedCode || "").toString() === target.code;

    // ‚úÖ zapisujemy wynik dla gminy z PYTANIA (target)
    statusByCode.set(target.code, isCorrect ? "ok" : "bad");

    // ustaw trwa≈Çy styl na target
    const targetLayer = layerByCode.get(target.code);
    if (targetLayer) {
      applyPersistentStyle(targetLayer);
      targetLayer.bringToFront();
    }

    // kr√≥tkie info wizualne dla z≈Çego klikniƒôcia (tylko flash), ale bez trwa≈Çego statusu
    if (!isCorrect && clickedLayer && clickedCode !== target.code) {
      clickedLayer.setStyle({ ...wrongStyle, fillOpacity: 0.35, weight: 2.2 });
      clickedLayer.bringToFront();
      setTimeout(() => applyPersistentStyle(clickedLayer), 650);
    }

    if (isCorrect) {
      state.score += 1;
      setMessage("‚úÖ Dobrze!", "ok");
    } else {
      setMessage("‚ùå ≈πle.", "bad");

      // je≈õli w≈ÇƒÖczone, poka≈º poprawnƒÖ gminƒô ‚Äûmocniej‚Äù na chwilƒô (opcjonalne)
      if (chkShowCorrect.checked && targetLayer) {
        targetLayer.setStyle(revealCorrectStyle);
        targetLayer.bringToFront();
        setTimeout(() => applyPersistentStyle(targetLayer), 900);
      }
    }

    state.done += 1;

    elScore.textContent = String(state.score);
    elDone.textContent  = String(state.done);
    if (elHudScore) elHudScore.textContent = String(state.score);
    if (elHudDone)  elHudDone.textContent  = String(state.done);

    // od≈õwie≈º style ca≈Çej warstwy zgodnie z mapƒÖ status√≥w
    // (wa≈ºne: to utrwala zielone/czerwone dla ju≈º ‚Äûwybranych‚Äù gmin)
    resetAllStyles();

    setPanel(false);

    btnNext.disabled = false;
    if (btnHudNext) btnHudNext.disabled = false;

    state.idx += 1;
  }

  // przyciski
  btnNext.addEventListener("click", () => nextQuestion());
  btnRestart.addEventListener("click", () => startGame());
  if (btnHudNext) btnHudNext.addEventListener("click", () => nextQuestion());
  if (btnHudRestart) btnHudRestart.addEventListener("click", () => startGame());

  chkLearnMode.addEventListener("change", () => {
    state.locked = false;
    btnNext.disabled = true;
    if (btnHudNext) btnHudNext.disabled = true;

    resetAllStyles();

    if (chkLearnMode.checked) {
      elTarget.textContent = "Tryb poznawania mapy";
      if (elHudTarget) elHudTarget.textContent = "Tryb poznawania mapy";
      setHudHeightVar();
      setMessage("Tooltipy sƒÖ w≈ÇƒÖczone. Klikniƒôcia nie punktujƒÖ. Odznacz tryb, aby graƒá.", "");
    } else {
      setMessage("Tryb gry: tooltipy wy≈ÇƒÖczone.", "");
      nextQuestion();
    }
  });

  // HUD height recalculation
  setTimeout(setHudHeightVar, 50);
  window.addEventListener("resize", () => setTimeout(setHudHeightVar, 50), { passive: true });
  window.addEventListener("orientationchange", () => setTimeout(setHudHeightVar, 200), { passive: true });

  // start
  startGame();
})();
</script>

</body>
</html>
